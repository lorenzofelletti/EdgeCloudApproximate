# Path: kafka.Dockerfile

#FROM bitnami/bitnami/kafka:3.3
FROM docker.io/bitnami/spark:3.3
#FROM docker.io/bitnami/spark:2.4.3-r3
USER root

WORKDIR /

RUN apt-get update
RUN apt-get install -y \
    build-essential \
    libssl-dev \
    pkg-config \
    git \
    vim \
    curl

## Update new packages
RUN apt-get update

COPY data/china /data/china
COPY cloud_analytics /cloud_analytics
COPY libraries /libraries

# Copy webapp
COPY flask_data_viz /flask_data_viz
# create venv
ENV flask_app_path /flask_data_viz
RUN python3 -m venv ${flask_app_path}/venv
# install requirements
RUN ${flask_app_path}/venv/bin/python -m pip install -r ${flask_app_path}/requirements.txt

# Setup startup script
COPY ./kafka-rs-configs/startup-spark.sh /startup.sh
RUN chmod +x /startup.sh

